<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Javascript Hangman (Beta)</title>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-19082249-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
  })();
</script>

<style type="text/css">
body {
	font-family:Arial, Helvetica, sans-serif;
}
form { 
	/*width:450px;*/
	clear:both;
}
fieldset {
	border:#900 solid 2px;
	background-color:#f2f2e6;
}
legend { 
	font-style:italic;
	font-weight:bold;
}

#message {
	height:20px;
}

#game { 
	width:479px;
	margin:0 auto;
}

#credits {
	border-top:1px solid #ccc;
	clear:both;
	width:479px;
	margin:1em auto;
	color:#999;
}

#gallows,
#guessedLetters {
	height:200px;
}

#gallows { 
	float:left;
	border:dashed 2px #900;
	background-color:#f2f2e6;
	width: 160px;
	padding:10px;
}

#guessedLetters { 
	float:left;
	border:dashed 2px #900;
	border-left:none;
	background-color:#f2f2e6;
	width: 270px;
	padding:10px;
	font-size:200%;
}

#word {
	padding: 0 10px 10px 10px;
	text-align:center;
	line-height:2.5em;
}

#word input {
	width:1em;
	text-align:center;
	font-size:large;
	font-weight:bold;
	border:1px solid #CCC;
	border-bottom:2px solid black;
}
.letter,
.letterExists,
.letterDoesNotExist {
	font-weight:bold;
	color:#000;
	background-color:#fafaee;
	border:1px solid #eaeade;
	text-decoration:none;
	display:block;
	float:left;
	width:1.05em;
	text-align:center;
}

.letterExists {
	color: green;
}
.letterDoesNotExist {
	color: #900;
	text-decoration:line-through;
}
</style>
<script type="text/javascript">
var cards = [
        {"category": "phrase", "word": "a penny saved is a penny earned"},
        {"category": "place", "word": "johannesburg, south africa"},
        {"category": "person", "word": "marcel marceau"},
		  {"category": "person", "word": "karl marx"},
		  {"category": "book", "word": "The Scarlet Letter"},
		  {"category": "tv show", "word": "Eight is Enough"},
		  {"category": "movie", "word": "Ferris Bueller's Day Off"},
		  {"category": "movie", "word": "Wayne's World"},
		  {"category": "book", "word": "The Great Gatsby"},
		  {"category": "phrase", "word": "Neither a borrower, nor a lender be"},
		  {"category": "person", "word": "keira knightley"},
		  {"category": "place", "word": "Chattanooga, Tennessee"},
		  {"category": "place", "word": "Milwaukee, Wisconsin"},
		  {"category": "place", "word": "Tapei, Taiwan"},
		  {"category": "person", "word": "Lionel Richie"},
		  {"category": "person", "word": "Richard Nixon"},
		  {"category": "movie", "word": "Spartacus"},
		  {"category": "movie", "word": "The Big Chill"},
		  {"category": "tv show", "word": "Miami Vice"},
		  {"category": "book", "word": "harry potter and the half blood prince"}
    ];


var punc = ",.?!' ";
var linelength = 16;
var isGameOver;


function Word(c,w) {
	this.category = c;
	w = w.toUpperCase();
	this.word = w;
	this.letters = w.split("");
}

function Word_getBreakpoint(n) {
	var breakpoint;

	if (this.letters.length-n>linelength) {
		for (var i=n; i<this.letters.length && i<n+linelength; i++) {
			if (this.letters[i]==" ") {
				breakpoint=i;
			}
		}
	}

	return breakpoint;
}


function Word_build() {
	var punc = ",.?!' ";
	var breakpoint = 0;
	var j=0;
	// set current category
	set("category").innerHTML=this.category;
	// clear current word
	set("word").innerHTML='';
	
	if (this.word.length > linelength) {
		breakpoint = this.getBreakpoint(0);
	}
	
	for (var i in this.letters) {
		var regex = new RegExp(this.letters[i]);

		if ( punc.search(regex) < 0 ) {
			set("word").innerHTML += '<input type="text" size="1" maxlength="1" id="w'+i+'">&nbsp;';
		} else {
			set("word").innerHTML += this.letters[i] + '&nbsp;';
		}
		
		if ( i == breakpoint && breakpoint != 0 ) {
			// Add break
			set("word").innerHTML += "<br>";
			// Set new breakpoint
			breakpoint = this.getBreakpoint(breakpoint);
		}
	}
}

function Word_disable() {
	for (var i in this.letters) {
		if (set("w"+i)) {
			set("w"+i).value=this.letters[i];
			set("w"+i).disabled=true;
		}
	}
}


Word.prototype.build = Word_build;
Word.prototype.disable = Word_disable;
Word.prototype.getBreakpoint = Word_getBreakpoint;


function Gallows() {
	this.failures;
}

function Gallows_display() {
	set("gallows").innerHTML = '<img src="' + this.failures + '.png" width="200" height="150" alt="' + (6-this.failures) + 'Chances Left!">';
}

function Gallows_get() {
	return this.failures;
}

function Gallows_set(n) {
	this.failures = n;
}

function Gallows_message(ltr) {
	var msg;
	switch (this.failures) {
		case 5:
			msg="DANGER--Guess carefully!";
			break;
		case 4:
			msg="Uh-oh, things aren't looking good....";
			break;
		default:
			msg="Ouch! There are no " + ltr + "'s!";
			break;
	}
	return msg;
}

Gallows.prototype.display = Gallows_display;
Gallows.prototype.get = Gallows_get;
Gallows.prototype.set = Gallows_set;
Gallows.prototype.message = Gallows_message;

function Letter(l) {
	this.value = l;
	this.guessed = false;
}

function Letter_getValue() {
	return this.value;
}

function Letter_setValue(v) {
	this.value = v;
}

function Letter_getGuessed() {
	return this.guessed;
}

function Letter_setGuessed(b) {
	this.guessed = b;
}

Letter.prototype.getValue = Letter_getValue;
Letter.prototype.setValue = Letter_setValue;
Letter.prototype.getGuessed = Letter_getGuessed;
Letter.prototype.setGuessed = Letter_setGuessed;

function Alphabet() {
	this.test;
	this.abc = "abcdefghijklmnopqrstuvwxyz".toUpperCase();
	for (var i in "abcdefghijklmnopqrstuvwxyz".toUpperCase()) {
		this[this.abc[i]] = new Letter(this.abc[i]);
		//dump(i,this[abc[i]].value);
	} 
//	this.letters = "abcdefghijklmnopqrstuvwxyz".toUpperCase().split();
//	for (var i in this.letters) this.i = false;
}

function Guess(g) {
	this.letter = g.toUpperCase();
}


function buildWord() {
for (var i in letters) {
	set("word").innerHTML += '<input type="text" size="1" id="w'+i+'"> ';
}	
}



function checkGuess(ltr) {
	if ( !isGameOver ) {
		var exists = false;
		var occurrences = 0;
		display("message","");
		ltr = ltr.toUpperCase();
		//var ltr = set("tryit").value.toUpperCase();
		set("tryit").value = "";
		if ( ltr >= 'A' && ltr <= 'Z' ) {
			var myGuess = new Guess(ltr);
			if ( alpha[myGuess.letter] && alpha[myGuess.letter].getGuessed(true) ) {
				display("message","You already guessed " + alpha[myGuess.letter].getValue());
			} else {
				alpha[myGuess.letter].setGuessed(true);
				for (var i in gameword.letters) {
					if ( gameword.letters[i] == myGuess.letter ) {
						set("w"+i).value = myGuess.letter;
						exists = true;
						occurrences+=1;
					}
				}
				if ( occurrences > 0 ) {
					set(myGuess.letter).className = "letterExists";
					if ( occurrences == 1 ) {
						display("message","There is " + occurrences + " " + ltr + "!");
					} else {
						display("message","There are " + occurrences + " " + ltr + "'s!");
					}
					// Check to see if the user has guessed all letters
					checkSolution();
				} else {
					set(myGuess.letter).className = "letterDoesNotExist";
					display("message","Ouch! There are no " + ltr + "'s!");
					noose.set(noose.get()+1);
					noose.display();
					display("message",noose.message(ltr));
					if (noose.get() >= 6) {
						lose();
					}
				}
			}
		}
	}
}

function checkSolution() {
	// Set up regular expression to remove punction & spaces -- we compare only the letter portion
	var regex = new RegExp("["+punc+"]","g");
	// String in solution form field
	var s = set("solution").value.toUpperCase();
	// Build string out of all letters on the board--in case the user has guessed all the letters
	var board = "";
	var letters = set("word").getElementsByTagName("input");
	for (var i=0; i<letters.length; i++) {
		board+=letters[i].value;
	}	
	if (s.replace(regex,"")==gameword.word.replace(regex,"") || board.replace(regex,"")==gameword.word.replace(regex,"")) {
		//dump("letters guessed so far",s);
		win();
	} else {
		//dump(s,gameword.word);
	}
}

function win() {
	// Display win message
	display("message",'You Win! <a href="javascript:init()">Play again</a>?');
	endGame();
}

function lose() {
	// Display lose message
	display("message",'You Lose! <a href="javascript:init()">Play again</a>');
	endGame();
}

function endGame() {
	// Hide guess letter / guess solution fieldsets
	hide("guess");
	hide("solve");
	// disable letters
	gameword.disable();
	// set game over indicator
	isGameOver = true;
}

function dumpAll() {
	for (var i in alpha) {
		dump("i",alpha[i].getGuessed());
	}
}


function display(id,msg) {
	if (set(id)) set(id).innerHTML=msg;
}

function dump(descr,value) {
	//This function dumps javascript data to the page, if a place for it exists.
	if (set("dump")) set("dump").innerHTML+=descr+" "+value+"<br>";
}

function set(id){return document.getElementById(id);}

function show (id,type){
	//type is an optional parameter. it should be either "block" or "inline"
	if (type === undefined) {
		type = "block";
	}
	document.getElementById(id).style.display = type;
}

function hide (id){
	document.getElementById(id).style.display = "none";
}

function init() {
	isGameOver = false;

	alpha = new Alphabet();

	noose = new Gallows();
	noose.set(0);
	noose.display();

	//dump("cards.length",cards.length);
	pick=Math.floor(Math.random()*cards.length);
	//dump("pick",pick);
	gameword = new Word(cards[pick].category,cards[pick].word);
	gameword.build();
	
	show("guess");
	show("solve");

	display("message","");
	set("guessedLetters").innerHTML = "";
	for (var i in alpha.abc) {
		set("guessedLetters").innerHTML += '<a href="" id="' + alpha.abc[i] + '" class="letter" onClick="checkGuess(\'' + alpha.abc[i] + '\'); return false;">' + alpha.abc[i] + '</a> ';
	}
}

function Game() {
	this.isOver = false;
	pick=Math.floor(Math.random()*cards.length);
	this.word = new Word(cards[pick].category,cards[pick].word);
}

</script>
</head>

<body onLoad="init();">
<div id="dump"></div>
<div id="game">
<div id="message"></div>
<div id="gallows"></div>
<div id="triesLeft"></div>
<div id="guessedLetters"></div>

<form onSubmit="checkGuess();return false">
<fieldset>
<legend id="category"></legend>
<div id="word"></div>
</fieldset>
<fieldset id="guess">
<legend>Guess a Letter</legend>
<input type="text" name="tryit" id="tryit" size="1" maxlength="1" onkeyup="checkGuess(this.value)"><!--<input type="submit" value="try it">--> 
<!-- <input type="button" value="I know the answer!" onClick="checkSolution()"> -->
(You can also click the letters listed above.)
</fieldset>
<fieldset id="solve">
<legend>Solve It!</legend>
<input type="text" name="solution" id="solution" size="50"> <input type="button" value="Solve It!" onClick="checkSolution()">
</fieldset>
</form>
</div>
<p id="credits">e-mail suggestions to <a href="chris@osric.com">chris@osric.com</a></p>
</body>
</html>
